version: '3'
services:
  # --- DỊCH VỤ DATABASE (Cũ - Giữ nguyên) ---
  db:
    image: postgres:14
    container_name: my_data_warehouse
    environment:
      POSTGRES_USER: dbt_user
      POSTGRES_PASSWORD: password123
      POSTGRES_DB: jaffle_shop_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # --- DỊCH VỤ SUPERSET (Mới - Thêm vào) ---
  superset:
    image: apache/superset
    container_name: my_dashboard
    ports:
      - "8088:8088"
    environment:
      # Key bảo mật (bắt buộc phải có để Superset chạy)
      SUPERSET_SECRET_KEY: "ban-tu-dien-vao-cho-nay-nhe-cai-gi-cung-duoc"
    # Lệnh tự động cài đặt (Tạo user admin, cài driver kết nối Postgres)
    command: >
      sh -c "
      pip install psycopg2-binary && 
      superset fab create-admin --username admin --firstname Superset --lastname Admin --email admin@superset.com --password admin &&
      superset db upgrade &&
      superset init &&
      /usr/bin/run-server.sh"
    depends_on:
      - db # Superset sẽ đợi Database sẵn sàng

volumes:
  postgres_data: